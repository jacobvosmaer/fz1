#!/bin/sh 
set -e

# This script converts a mono AdventureKid Waveform file (600 samples
# long) into an FZ-1 "wave synth" preset.

defaultvoice() {
  printf '\000\000\000\000\210\007\000\000\140\000\000\000\200\007\000\000'
  printf '\023\000\000\000\000\000\000\000\200\007\000\000\200\007\000\000'
  printf '\200\007\000\000\200\007\000\000\200\007\000\000\200\007\000\000'
  printf '\200\007\000\000\200\007\000\000\200\007\000\000\200\007\000\000'
  printf '\200\007\000\000\200\007\000\000\200\007\000\000\200\007\000\000'
  printf '\200\007\000\000\000\000\000\000\000\000\000\000\000\000\000\000'
  printf '\000\000\000\000\144\000\144\000\144\000\144\000\144\000\144\000'
  printf '\144\000\144\000\000\000\000\000\000\007\177\300\300\300\300\300'
  printf '\300\300\377\000\000\000\000\000\000\000\000\007\177\300\300\300'
  printf '\300\300\300\300\377\000\000\000\000\000\000\000\000\000\200\000'
  printf '\100\000\000\000\000\000\000\000\000\000\000\000\000\000\140\044'
  printf '\110\000%-12.12s\000\000' "$1"
  dd if=/dev/zero bs=832 count=1 status=none
}

if [ $# != 3 ]
then
  echo 'Usage: akwf-fzv IN OUT NAME' 1>&2
  exit 1
fi
in="$1"
out="$2"
name="$3"

tmp=$(mktemp)
trap "rm -- \"$tmp\"" EXIT

sox "$in" "$in" "$in" -t s16 -c 1 -L "$tmp" norm -6 rate -v 14112 trim 192s 192s
defaultvoice "$name" > "$out"
cat "$tmp" "$tmp" "$tmp" "$tmp" "$tmp" "$tmp" "$tmp" "$tmp" "$tmp" "$tmp" >> "$out"
dd if="$tmp" bs=16 count=1 status=none >> "$out"
dd if="$tmp" bs=16 skip=9 status=none >> "$out"
